<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>خود اظهاری نیاز آموزشی</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Brand palette matched to Fouman Chimie Persian logo */
            --primary-color: #0066B3; /* Brand blue */
            --primary-hover: #005190;
            --secondary-color: #0F172A; /* Deep slate for headings */
            --success-color: #10b981;
            --danger-color: #ef4444;
            --background-light: #f5f7fb;
            --card-background: #ffffff;
            --border-color: #dbe3ef;
            --border-hover: #c4d2e6;
            --focus-ring: rgba(0, 102, 179, 0.28);
            --text-primary: #15243a;
            --text-secondary: #475569;
            --text-muted: #90a4b8;
            --spacing: 1.5rem;
            --radius: 10px;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        /* Base styles and RTL setup */
        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Vazirmatn', 'Tahoma', 'B Roya', 'IRANSans', system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.75;
            color: var(--text-primary);
            background: linear-gradient(135deg, #f5f7fa 0%, #e8ecf1 100%);
            margin: 0;
            padding: 2rem 1rem;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 16px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Structure and Layout */
        .container {
            width: 100%;
            max-width: 920px;
            margin: 0 auto;
            padding: 2.5rem;
            background-color: var(--card-background);
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
        }

        header {
            padding-bottom: 2rem;
            border-bottom: 3px solid var(--primary-color);
            margin-bottom: 2.5rem;
            position: relative;
        }

        header::after {
            content: '';
            position: absolute;
            bottom: -3px;
            right: 0;
            width: 80px;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-color), transparent);
        }

        .brand-logo {
            display: block;
            margin: 0 auto 1rem auto;
            height: 52px;
            max-width: 100%;
            object-fit: contain;
        }

        header h1 {
            color: var(--primary-color);
            text-align: center;
            font-size: 2rem;
            font-weight: 700;
            margin: 0 0 0.75rem 0;
            letter-spacing: -0.02em;
        }

        header p {
            text-align: center;
            color: var(--text-secondary);
            margin-top: 0.5rem;
            font-size: 1.05rem;
            line-height: 1.8;
            font-weight: 400;
        }

        header p:first-of-type {
            font-weight: 600;
            color: var(--primary-color);
            font-size: 1.1rem;
        }

        main {
            padding: 0;
        }

        /* Form elements and Accessibility */
        .form-group {
            margin-bottom: 1.75rem;
            padding: 0;
            transition: all 0.2s ease;
        }

        .form-group:focus-within {
            transform: translateX(-2px);
        }

        label {
            display: block;
            margin-bottom: 0.625rem;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.95rem;
            letter-spacing: 0.01em;
        }

        input[type="text"],
        input[type="number"],
        textarea,
        input[type="file"],
        select {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid var(--border-color);
            border-radius: var(--radius);
            box-sizing: border-box;
            transition: all 0.2s ease;
            font-size: 1rem;
            font-family: inherit;
            text-align: right;
            background-color: var(--card-background);
            color: var(--text-primary);
            cursor: pointer;
        }

        select {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%231e293b' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: left 1rem center;
            padding-left: 2.5rem;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
        }

        input[type="text"]:hover,
        input[type="number"]:hover,
        textarea:hover,
        select:hover {
            border-color: var(--border-hover);
        }

        select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px var(--focus-ring);
            outline: none;
            background-color: #ffffff;
        }

        select option {
            padding: 0.5rem;
            background-color: white;
        }

        select:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        input[type="file"] {
            padding: 0.75rem;
            cursor: pointer;
            background-color: var(--background-light);
        }

        input[type="file"]:hover {
            background-color: #f1f5f9;
        }

        .form-text {
            display: block;
            margin-top: 0.5rem;
            font-size: 0.875rem;
            color: var(--text-muted);
            line-height: 1.6;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        textarea:focus,
        input[type="file"]:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px var(--focus-ring);
            outline: none;
            background-color: #ffffff;
        }

        input[type="text"]::placeholder,
        textarea::placeholder {
            color: var(--text-muted);
            opacity: 0.7;
        }

        textarea {
            resize: vertical;
            min-height: 120px;
            line-height: 1.7;
        }

        /* Checkbox and Radio Groups */
        .choice-group {
            padding: 1.5rem;
            border: 2px solid var(--border-color);
            border-radius: var(--radius);
            background-color: var(--background-light);
            transition: all 0.2s ease;
        }

        .choice-group:hover {
            border-color: var(--border-hover);
        }

        .choice-group legend {
            font-weight: 700;
            padding: 0 0.75rem;
            color: var(--primary-color);
            font-size: 1.05rem;
            margin-bottom: 0.5rem;
        }

        .choice-item {
            display: flex;
            align-items: center;
            margin-bottom: 0.75rem;
            padding: 0.625rem;
            cursor: pointer;
            border-radius: 6px;
            transition: background-color 0.2s ease;
        }

        .choice-item:hover {
            background-color: rgba(37, 99, 235, 0.05);
        }

        .choice-item:last-child {
            margin-bottom: 0;
        }

        .choice-item input[type="radio"],
        .choice-item input[type="checkbox"] {
            /* Hides default radio/checkbox */
            opacity: 0;
            width: 0;
            height: 0;
            margin: 0;
        }

        .choice-item label {
            /* Custom checkmark area */
            position: relative;
            padding-right: 32px;
            margin-bottom: 0;
            font-weight: 500;
            cursor: pointer;
            font-size: 1rem;
            user-select: none;
            color: var(--text-primary);
            line-height: 1.6;
        }

        .choice-item label::before {
            content: '';
            position: absolute;
            top: 50%;
            right: 0;
            transform: translateY(-50%);
            width: 22px;
            height: 22px;
            border: 2.5px solid var(--border-color);
            background-color: var(--card-background);
            border-radius: 5px; /* for checkbox */
            transition: all 0.2s ease;
        }

        .choice-item input[type="radio"] + label::before {
            border-radius: 50%; /* for radio */
        }

        .choice-item input[type="checkbox"]:checked + label::before,
        .choice-item input[type="radio"]:checked + label::before {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            border-width: 2.5px;
        }

        .choice-item input:checked + label::after {
            content: '✓'; /* Checkmark icon */
            position: absolute;
            top: 50%;
            right: 4px;
            transform: translateY(-50%);
            font-size: 16px;
            font-weight: bold;
            color: var(--card-background);
            line-height: 1;
        }

        .choice-item input[type="radio"]:checked + label::after {
            content: '';
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--card-background);
            top: 50%;
            right: 6px;
            transform: translateY(-50%);
        }
        
        /* Focus state for accessibility */
        .choice-item input:focus + label::before {
            box-shadow: 0 0 0 4px var(--focus-ring);
        }

        /* Other Skills Container */
        .other-skills-container {
            margin-top: 1.5rem;
            padding: 1.5rem;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border: 2px solid var(--border-color);
            border-radius: var(--radius);
            animation: slideDown 0.3s ease;
        }

        .other-skills-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
            color: var(--primary-color);
            font-weight: 600;
            font-size: 0.95rem;
        }

        .other-skills-header svg {
            flex-shrink: 0;
        }

        .other-skills-inputs {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .other-skill-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            position: relative;
        }

        .other-skill-item:first-child .remove-skill-btn {
            display: none !important;
        }

        .skill-other-input {
            flex: 1;
            padding: 0.75rem 1rem;
            border: 2px solid var(--border-color);
            border-radius: var(--radius);
            font-size: 0.95rem;
            font-family: inherit;
            transition: all 0.2s ease;
            background-color: white;
        }

        .skill-other-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px var(--focus-ring);
            outline: none;
        }

        .remove-skill-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            padding: 0;
            border: 2px solid var(--danger-color);
            border-radius: var(--radius);
            background-color: white;
            color: var(--danger-color);
            cursor: pointer;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        .remove-skill-btn:hover {
            background-color: var(--danger-color);
            color: white;
            transform: scale(1.05);
        }

        .remove-skill-btn:active {
            transform: scale(0.95);
        }

        .add-skill-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            width: 100%;
            margin-top: 1rem;
            padding: 0.75rem 1rem;
            border: 2px dashed var(--border-color);
            border-radius: var(--radius);
            background-color: white;
            color: var(--primary-color);
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .add-skill-btn:hover {
            border-color: var(--primary-color);
            background-color: var(--background-light);
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }

        .add-skill-btn:active {
            transform: translateY(0);
        }

        .add-skill-btn svg {
            transition: transform 0.2s ease;
        }

        .add-skill-btn:hover svg {
            transform: rotate(90deg);
        }

        /* Validation UI */
        .error-message {
            color: var(--danger-color);
            margin-top: 0.625rem;
            font-size: 0.875rem;
            font-weight: 500;
            display: none; /* Initially hidden */
            padding-right: 0.5rem;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-5px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        input:invalid:not(:placeholder-shown),
        textarea:invalid:not(:placeholder-shown) {
            border-color: var(--danger-color);
        }

        .is-invalid input,
        .is-invalid textarea {
            border-color: var(--danger-color);
        }

        .is-invalid .error-message {
            display: block;
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.875rem 1.75rem;
            margin: 0.5rem 0.5rem 0.5rem 0;
            font-size: 1rem;
            font-weight: 600;
            font-family: inherit;
            text-align: center;
            cursor: pointer;
            border: none;
            border-radius: var(--radius);
            transition: all 0.2s ease;
            box-shadow: var(--shadow-sm);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-hover);
            box-shadow: var(--shadow);
            transform: translateY(-1px);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background-color: var(--secondary-color);
            color: white;
        }

        .btn-secondary:hover {
            background-color: #475569;
            box-shadow: var(--shadow);
            transform: translateY(-1px);
        }

        .btn-secondary:active {
            transform: translateY(0);
        }

        .btn:focus {
            outline: none;
            box-shadow: 0 0 0 4px var(--focus-ring), var(--shadow);
        }

        /* Submit Button - Larger Size */
        #submit-btn {
            width: 100%;
            padding: 1.25rem 2.5rem;
            font-size: 1.15rem;
            min-height: 56px;
        }

        #submit-btn svg {
            width: 20px;
            height: 20px;
        }

        /* Priority/Ranking - New Card-based Design */
        .priority-container-new {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.25rem;
            margin-top: 1rem;
        }

        .priority-card {
            position: relative;
            padding: 1.5rem;
            border: 2px solid var(--border-color);
            border-radius: var(--radius);
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            transition: all 0.3s ease;
            cursor: default;
        }

        .priority-card:hover {
            border-color: var(--border-hover);
            box-shadow: var(--shadow);
            transform: translateY(-2px);
        }

        .priority-card.has-priority {
            border-color: var(--primary-color);
            background: linear-gradient(135deg, #ffffff 0%, #f0f7ff 100%);
        }

        .priority-card-header {
            margin-bottom: 1.25rem;
            text-align: center;
        }

        .priority-card-title {
            margin: 0;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .priority-buttons {
            display: flex;
            justify-content: center;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .priority-btn {
            width: 56px;
            height: 56px;
            padding: 0;
            border: 2.5px solid var(--border-color);
            border-radius: 12px;
            background-color: white;
            color: var(--text-primary);
            font-size: 1.5rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: inherit;
            position: relative;
        }

        .priority-btn:hover {
            border-color: var(--primary-color);
            background-color: var(--background-light);
            transform: scale(1.05);
            box-shadow: var(--shadow-sm);
        }

        .priority-btn.selected {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        .priority-btn.selected::after {
            content: '✓';
            position: absolute;
            top: -4px;
            left: -4px;
            width: 20px;
            height: 20px;
            background-color: var(--success-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: white;
            font-weight: bold;
        }

        .priority-selected-indicator {
            margin-top: 1rem;
            padding: 0.5rem;
            text-align: center;
            font-size: 0.875rem;
            color: var(--primary-color);
            font-weight: 600;
            opacity: 0;
            transform: translateY(-5px);
            transition: all 0.2s ease;
        }

        .priority-card.has-priority .priority-selected-indicator {
            opacity: 1;
            transform: translateY(0);
        }

        @media (max-width: 768px) {
            .priority-container-new {
                grid-template-columns: 1fr;
            }
        }

        /* Course Links Container */
        .course-links-container {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .course-links-inputs {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .course-link-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .course-link-item:first-child .remove-link-btn {
            display: none !important;
        }

        .course-link-input-wrapper {
            flex: 1;
            position: relative;
            display: flex;
            align-items: center;
        }

        .link-icon {
            position: absolute;
            right: 1rem;
            color: var(--text-muted);
            pointer-events: none;
            z-index: 1;
        }

        .course-link-input {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 3rem;
            border: 2px solid var(--border-color);
            border-radius: var(--radius);
            font-size: 0.95rem;
            font-family: inherit;
            transition: all 0.2s ease;
            background-color: white;
            color: var(--text-primary);
            direction: ltr;
            text-align: left;
        }

        .course-link-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px var(--focus-ring);
            outline: none;
        }

        .course-link-input:valid {
            border-color: var(--success-color);
        }

        .course-link-input:invalid:not(:placeholder-shown) {
            border-color: var(--danger-color);
        }

        .remove-link-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            padding: 0;
            border: 2px solid var(--danger-color);
            border-radius: var(--radius);
            background-color: white;
            color: var(--danger-color);
            cursor: pointer;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        .remove-link-btn:hover {
            background-color: var(--danger-color);
            color: white;
            transform: scale(1.05);
        }

        .remove-link-btn:active {
            transform: scale(0.95);
        }

        .add-link-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            width: 100%;
            margin-top: 0.5rem;
            padding: 0.75rem 1rem;
            border: 2px dashed var(--border-color);
            border-radius: var(--radius);
            background-color: white;
            color: var(--primary-color);
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .add-link-btn:hover {
            border-color: var(--primary-color);
            background-color: var(--background-light);
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }

        .add-link-btn:active {
            transform: translateY(0);
        }

        .add-link-btn svg {
            transition: transform 0.2s ease;
        }

        .add-link-btn:hover svg {
            transform: rotate(90deg);
        }
        
        /* PDF Preview and Fallback UI */
        #pdf-preview-container {
            margin-top: 1.5rem;
            padding: 1.5rem;
            border: 2px dashed var(--border-color);
            border-radius: var(--radius);
            background: linear-gradient(135deg, #fff9f0 0%, #fef3e8 100%);
            display: none;
            transition: all 0.3s ease;
        }

        #pdf-preview-container:hover {
            border-color: var(--primary-color);
        }

        #pdf-preview-text {
            font-size: 0.95rem;
            line-height: 1.8;
        }
        
        #pdf-preview-text span {
            display: inline-block;
            padding: 0.5rem 0.75rem;
            margin: 0.25rem;
            background-color: white;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            line-height: 1.6;
            font-size: 0.9rem;
        }
        
        #pdf-preview-text span:hover {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
        }
        
        /* Modal */
        .modal {
            display: none; /* Hidden by default */
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            animation: fadeIn 0.2s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        .modal-content {
            background-color: var(--card-background);
            margin: 10% auto;
            padding: 2rem;
            border: none;
            width: 90%;
            max-width: 550px;
            border-radius: var(--radius);
            text-align: center;
            box-shadow: var(--shadow-lg);
            animation: slideUp 0.3s ease;
            position: relative;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-content h3 {
            margin: 0 0 1rem 0;
            color: var(--text-primary);
            font-size: 1.5rem;
            font-weight: 700;
        }

        .modal-content p {
            color: var(--text-secondary);
            line-height: 1.7;
            margin-bottom: 1.5rem;
        }

        .close-btn {
            color: var(--text-muted);
            float: left;
            font-size: 32px;
            font-weight: bold;
            line-height: 1;
            transition: all 0.2s ease;
            cursor: pointer;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .close-btn:hover,
        .close-btn:focus {
            color: var(--text-primary);
            background-color: var(--background-light);
        }

        /* Coming Soon State */
        .coming-soon-container {
            margin: 2rem 0;
            padding: 3rem 2rem;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border: 2px dashed var(--border-color);
            border-radius: var(--radius);
            text-align: center;
            animation: fadeIn 0.4s ease;
        }

        .coming-soon-content {
            max-width: 500px;
            margin: 0 auto;
        }

        .coming-soon-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 1.5rem;
            color: var(--primary-color);
            opacity: 0.7;
        }

        .coming-soon-content h2 {
            color: var(--text-primary);
            font-size: 1.75rem;
            font-weight: 700;
            margin: 0 0 1rem 0;
        }

        .coming-soon-content p {
            color: var(--text-secondary);
            font-size: 1.05rem;
            line-height: 1.8;
            margin: 0.75rem 0;
        }

        .coming-soon-note {
            color: var(--text-muted);
            font-size: 0.95rem;
            font-style: italic;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color);
        }

        #main-form-fields {
            animation: fadeIn 0.3s ease;
        }

        /* Footer */
        footer {
            width: 100%;
            text-align: center;
            padding: 1.5rem 0 0 0;
            margin-top: 2.5rem;
            border-top: 2px solid var(--border-color);
            color: var(--text-secondary);
            font-size: 0.875rem;
            line-height: 1.7;
        }

        /* Responsive design (mobile first) */
        @media (max-width: 768px) {
            body {
                padding: 1rem 0.5rem;
            }

            .container {
                padding: 1.5rem;
                border-radius: 12px;
            }

            header h1 {
                font-size: 1.75rem;
            }

            header p {
                font-size: 0.95rem;
            }

            .btn {
                width: 100%;
                margin: 0.5rem 0;
            }

            .priority-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.75rem;
            }

            .priority-item input[type="number"] {
                width: 100%;
            }
        }

        @media (min-width: 769px) {
            .container {
                padding: 2.5rem;
            }
            
            header h1 {
                font-size: 2.25rem;
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <img class="brand-logo" src="https://foumanchimie.com/wp-content/uploads/2023/11/foumanchimie-persian-2-300x74.png" alt="لوگوی فومن شیمی">
            <h1>خود اظهاری نیاز آموزشی</h1>
            <p>  </p>
            <p>لطفاً اطلاعات خود و نیازهای آموزشی‌تان را با دقت تکمیل کنید.</p>
        </header>

        <main>
            <form id="training-needs-form" aria-label="فرم خود اظهاری نیاز آموزشی کارکنان" novalidate>
                <div class="form-group" id="group-personnel-id">
                    <label for="personnel-id">کد پرسنلی:</label>
                    <input type="text" id="personnel-id" name="personnel-id" required aria-required="true" placeholder="کد پرسنلی خود را وارد کنید">
                    <div class="error-message">لطفاً کد پرسنلی را وارد کنید.</div>
                </div>

                <div class="form-group" id="group-fullname">
                    <label for="full-name">نام و نام خانوادگی:</label>
                    <input type="text" id="full-name" name="full-name" required aria-required="true" placeholder="نام خود را وارد کنید">
                    <div class="error-message">لطفاً نام و نام خانوادگی را وارد کنید.</div>
                </div>

                <div class="form-group" id="group-jobtitle">
                    <label for="job-title">سمت و عنوان شغلی:</label>
                    <input type="text" id="job-title" name="job-title" required aria-required="true" placeholder="مانند: کارشناس منابع انسانی">
                    <div class="error-message">لطفاً سمت و عنوان شغلی خود را وارد کنید.</div>
                </div>

                <fieldset class="form-group choice-group" aria-required="true">
                    <legend>سابقه خدمت در سازمان <span style="color: var(--danger-color);">*</span></legend>
                    <div class="choice-item">
                        <input type="radio" id="service-less1" name="years-of-service" value="کمتر از یک سال" required>
                        <label for="service-less1">کمتر از یک سال</label>
                    </div>
                    <div class="choice-item">
                        <input type="radio" id="service-1to3" name="years-of-service" value="1 تا 3 سال" required>
                        <label for="service-1to3">1 تا 3 سال</label>
                    </div>
                    <div class="choice-item">
                        <input type="radio" id="service-more3" name="years-of-service" value="بیش از 3 سال" required>
                        <label for="service-more3">بیش از 3 سال</label>
                    </div>
                    <div class="error-message" id="error-years-of-service">لطفاً سابقه خدمت خود را انتخاب کنید.</div>
                </fieldset>

                <div class="form-group" id="group-department">
                    <label for="department">واحد سازمانی <span style="color: var(--danger-color);">*</span></label>
                    <select class="form-select" id="department" name="department" required aria-required="true">
                        <option value="" selected disabled>انتخاب کنید</option>
                    </select>
                    <div class="error-message">لطفاً واحد سازمانی خود را انتخاب کنید.</div>
                </div>

                <!-- Empty state for non-HR departments -->
                <div id="coming-soon-state" class="coming-soon-container" style="display: none;">
                    <div class="coming-soon-content">
                        <svg class="coming-soon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"></circle>
                            <polyline points="12 6 12 12 16 14"></polyline>
                        </svg>
                        <h2>در حال توسعه</h2>
                        <p>فرم خود اظهاری نیاز آموزشی برای واحد شما به زودی فعال خواهد شد.</p>
                        <p class="coming-soon-note">در حال حاضر، این سیستم تنها برای واحد منابع انسانی در دسترس می‌باشد.</p>
                    </div>
                </div>

                <!-- Main form fields (shown only for HR department) -->
                <div id="main-form-fields">
                <fieldset class="form-group choice-group" aria-required="true">
                    <legend>حوزه فعالیت اصلی <span style="color: var(--danger-color);">*</span></legend>
                    <div class="choice-item">
                        <input type="checkbox" id="area-admin" name="activity-area" value="امور اداری">
                        <label for="area-admin">امور اداری</label>
                    </div>
                    <div class="choice-item">
                        <input type="checkbox" id="area-comp" name="activity-area" value="جبران خدمات و حقوق و دستمزد">
                        <label for="area-comp">جبران خدمات و حقوق و دستمزد</label>
                    </div>
                    <div class="choice-item">
                        <input type="checkbox" id="area-training" name="activity-area" value="توسعه و آموزش">
                        <label for="area-training">توسعه و آموزش</label>
                    </div>
                    <div class="choice-item">
                        <input type="checkbox" id="area-recruitment" name="activity-area" value="جذب و استخدام">
                        <label for="area-recruitment">جذب و استخدام</label>
                    </div>
                    <div class="error-message" id="error-activity-area">لطفاً حداقل یکی از حوزه های فعالیت اصلی را انتخاب کنید.</div>
                </fieldset>
                
                <fieldset class="form-group choice-group" aria-required="true">
                    <legend>کدام مهارت‌ها/دانش‌ها برای بهبود عملکردتان لازم است؟ (حداقل 3، حداکثر 5 انتخاب) <span style="color: var(--danger-color);">*</span></legend>
                    
                    <div class="skill-checkbox-container">
                        <div class="choice-item">
                            <input type="checkbox" id="skill-law" name="required-skills" value="قوانین و مقررات کار و بیمه">
                            <label for="skill-law">قوانین و مقررات کار و بیمه</label>
                        </div>
                        <div class="choice-item">
                            <input type="checkbox" id="skill-compdesign" name="required-skills" value="طراحی نظام جبران خدمات">
                            <label for="skill-compdesign">طراحی نظام جبران خدمات</label>
                        </div>
                        <div class="choice-item">
                            <input type="checkbox" id="skill-interview" name="required-skills" value="مصاحبه و ارزیابی شایستگی ها">
                            <label for="skill-interview">مصاحبه و ارزیابی شایستگی ها</label>
                        </div>
                        <div class="choice-item">
                            <input type="checkbox" id="skill-talent" name="required-skills" value="مدیریت استعدادها">
                            <label for="skill-talent">مدیریت استعدادها</label>
                        </div>
                        <div class="choice-item">
                            <input type="checkbox" id="skill-performance" name="required-skills" value="مدیریت عملکرد">
                            <label for="skill-performance">مدیریت عملکرد</label>
                        </div>
                        <div class="choice-item">
                            <input type="checkbox" id="skill-trainingdesign" name="required-skills" value="طراحی و ارزیابی اثربخشی آموزش">
                            <label for="skill-trainingdesign">طراحی و ارزیابی اثربخشی آموزش</label>
                        </div>
                        <div class="choice-item">
                            <input type="checkbox" id="skill-comm" name="required-skills" value="مهارتهای ارتباطی و مذاکره">
                            <label for="skill-comm">مهارتهای ارتباطی و مذاکره</label>
                        </div>
                        <div class="choice-item">
                            <input type="checkbox" id="skill-hrsw" name="required-skills" value="کار با نرم‌افزارهای منابع انسانی (SAP، اکسل، HRIS و...)">
                            <label for="skill-hrsw">کار با نرم‌افزارهای منابع انسانی (SAP، اکسل، HRIS و...)</label>
                        </div>
                        <div class="choice-item">
                            <input type="checkbox" id="skill-dashboard" name="required-skills" value="طراحی داشبوردهای منابع انسانی">
                            <label for="skill-dashboard">طراحی داشبوردهای منابع انسانی</label>
                        </div>
                        <div class="choice-item">
                            <input type="checkbox" id="skill-exec" name="required-skills" value="امور اجرایی و ادمین">
                            <label for="skill-exec">امور اجرایی و ادمین</label>
                        </div>
                        <div class="choice-item" id="skill-other-checkbox-wrapper">
                            <input type="checkbox" id="skill-other-checkbox" name="required-skills" value="other">
                            <label for="skill-other-checkbox">سایر (موارد دیگر)</label>
                        </div>
                    </div>
                    
                    <!-- Other skills input container (shown when "other" is checked) -->
                    <div id="other-skills-container" class="other-skills-container" style="display: none;">
                        <div class="other-skills-header">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="12" y1="8" x2="12" y2="12"></line>
                                <line x1="12" y1="16" x2="12.01" y2="16"></line>
                            </svg>
                            <span>مهارت‌های دیگری که نیاز دارید را وارد کنید:</span>
                        </div>
                        <div id="other-skills-inputs" class="other-skills-inputs">
                            <div class="other-skill-item">
                                <input type="text" class="skill-other-input" name="required-skills-other" placeholder="مثال: مدیریت تغییر، تحلیل داده‌ها و..." maxlength="100">
                                <button type="button" class="remove-skill-btn" style="display: none;" aria-label="حذف">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <line x1="18" y1="6" x2="6" y2="18"></line>
                                        <line x1="6" y1="6" x2="18" y2="18"></line>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <button type="button" id="add-another-skill-btn" class="add-skill-btn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            افزودن مهارت دیگر
                        </button>
                    </div>
                    
                    <div class="error-message" id="error-required-skills">لطفاً حداقل 3 و حداکثر 5 مهارت را انتخاب کنید.</div>
                </fieldset>

                <fieldset class="form-group choice-group" aria-required="true">
                    <legend>نوع آموزش مورد نظر خود را اولویت‌بندی کنید <span style="color: var(--danger-color);">*</span></legend>
                    <p style="margin-bottom: 1.25rem; color: var(--text-secondary); font-size: 0.9rem; text-align: center;">
                        برای هر نوع آموزش، اولویت مورد نظر خود را انتخاب کنید (1 = بالاترین اولویت)
                    </p>
                    
                    <div class="priority-container-new" id="training-priorities">
                        <div class="priority-card" data-type="online">
                            <div class="priority-card-header">
                                <h3 class="priority-card-title">آنلاین (زنده)</h3>
                            </div>
                            <div class="priority-buttons">
                                <button type="button" class="priority-btn" data-priority="1" aria-label="اولویت 1">1</button>
                                <button type="button" class="priority-btn" data-priority="2" aria-label="اولویت 2">2</button>
                                <button type="button" class="priority-btn" data-priority="3" aria-label="اولویت 3">3</button>
                                <button type="button" class="priority-btn" data-priority="4" aria-label="اولویت 4">4</button>
                            </div>
                            <input type="hidden" id="priority-online" name="priority-online" value="" required>
                            <div class="priority-selected-indicator"></div>
                        </div>
                        
                        <div class="priority-card" data-type="inperson">
                            <div class="priority-card-header">
                                <h3 class="priority-card-title">حضوری</h3>
                            </div>
                            <div class="priority-buttons">
                                <button type="button" class="priority-btn" data-priority="1" aria-label="اولویت 1">1</button>
                                <button type="button" class="priority-btn" data-priority="2" aria-label="اولویت 2">2</button>
                                <button type="button" class="priority-btn" data-priority="3" aria-label="اولویت 3">3</button>
                                <button type="button" class="priority-btn" data-priority="4" aria-label="اولویت 4">4</button>
                            </div>
                            <input type="hidden" id="priority-inperson" name="priority-inperson" value="" required>
                            <div class="priority-selected-indicator"></div>
                        </div>
                        
                        <div class="priority-card" data-type="blended">
                            <div class="priority-card-header">
                                <h3 class="priority-card-title">ترکیبی</h3>
                            </div>
                            <div class="priority-buttons">
                                <button type="button" class="priority-btn" data-priority="1" aria-label="اولویت 1">1</button>
                                <button type="button" class="priority-btn" data-priority="2" aria-label="اولویت 2">2</button>
                                <button type="button" class="priority-btn" data-priority="3" aria-label="اولویت 3">3</button>
                                <button type="button" class="priority-btn" data-priority="4" aria-label="اولویت 4">4</button>
                            </div>
                            <input type="hidden" id="priority-blended" name="priority-blended" value="" required>
                            <div class="priority-selected-indicator"></div>
                        </div>
                        
                        <div class="priority-card" data-type="offline">
                            <div class="priority-card-header">
                                <h3 class="priority-card-title">آفلاین (ضبط شده)</h3>
                            </div>
                            <div class="priority-buttons">
                                <button type="button" class="priority-btn" data-priority="1" aria-label="اولویت 1">1</button>
                                <button type="button" class="priority-btn" data-priority="2" aria-label="اولویت 2">2</button>
                                <button type="button" class="priority-btn" data-priority="3" aria-label="اولویت 3">3</button>
                                <button type="button" class="priority-btn" data-priority="4" aria-label="اولویت 4">4</button>
                            </div>
                            <input type="hidden" id="priority-offline" name="priority-offline" value="" required>
                            <div class="priority-selected-indicator"></div>
                        </div>
                    </div>
                    <div class="error-message" id="error-priorities">لطفاً برای هر 4 نوع آموزش، یک اولویت منحصر به فرد انتخاب کنید.</div>
                </fieldset>

                <!-- Course Links Section -->
                <div class="form-group" style="margin-top: 2rem;">
                    <label for="course-links">لینک دوره‌های آموزشی (اختیاری)</label>
                    <p style="margin-bottom: 1rem; color: var(--text-secondary); font-size: 0.875rem;">
                        در صورت داشتن لینک دوره‌های آموزشی مرتبط، می‌توانید آن‌ها را در این قسمت اضافه کنید.
                    </p>
                    
                    <div id="course-links-container" class="course-links-container">
                        <div id="course-links-inputs" class="course-links-inputs">
                            <div class="course-link-item">
                                <div class="course-link-input-wrapper">
                                    <svg class="link-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                                        <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                                    </svg>
                                    <input type="url" class="course-link-input" name="course-links" placeholder="https://example.com/course" pattern="https?://.+" maxlength="500">
                                </div>
                                <button type="button" class="remove-link-btn" style="display: none;" aria-label="حذف لینک">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <line x1="18" y1="6" x2="6" y2="18"></line>
                                        <line x1="6" y1="6" x2="18" y2="18"></line>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <button type="button" id="add-another-link-btn" class="add-link-btn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            افزودن لینک دیگر
                        </button>
                    </div>
                </div>

                <div class="form-group" style="margin-top: 2rem;">
                    <label for="additional-comments">توضیحات تکمیلی (اختیاری)</label>
                    <textarea id="additional-comments" name="additional-comments" placeholder="هر توضیح دیگری که لازم می‌دانید"></textarea>
                </div>
                </div>
                <!-- End of main-form-fields -->

                <div style="margin-top: 2rem;">
                    <button type="submit" class="btn btn-primary" id="submit-btn">
                        ارسال 
                        <svg style="margin-right: 8px; vertical-align: middle;" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                        </svg>
                    </button>
                </div>

            </form>
        </main>
        
        <footer>
            <p>این فرم توسط شرکت فومن شیمی برای جمع‌آوری نیازهای آموزشی داخلی تهیه شده است. تمام حقوق محفوظ است.</p>
        </footer>

    </div>

    <div id="confirmation-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" aria-label="بستن پنجره">&times;</span>
            <h3 id="modal-title"></h3>
            <p id="modal-message"></p>
            <button type="button" class="btn btn-primary" onclick="document.getElementById('confirmation-modal').style.display='none'">بسیار خوب</button>
        </div>
    </div>
    
    <script src="./organization-units.js"></script>
    <script>
        // DEVELOPER NOTE: All strings for localization (messages, errors, labels, etc.) should be changed in the HTML or in this 'STRINGS' object if they are dynamic.
        const STRINGS = {
            errorRequired: 'پر کردن این فیلد اجباری است.',
            errorMinSkills: 'لطفاً حداقل {min} مهارت را انتخاب کنید.',
            errorMaxSkills: 'شما مجاز به انتخاب حداکثر {max} مهارت هستید.',
            errorFileTooLarge: 'حجم فایل از 8 مگابایت بیشتر است.',
            errorFileType: 'فرمت فایل مجاز نیست. فقط PDF, DOCX, PNG, JPG.',
            errorPriorityConflict: 'اولویت‌های وارد شده باید اعداد 1 تا 4 و بدون تکرار باشند.',
            successTitle: '✅ موفقیت آمیز',
            successMessage: 'درخواست شما با موفقیت ثبت و ارسال شد. از همکاری شما سپاسگزاریم.',
            errorSubmissionTitle: '❌ خطا در ارسال',
            errorSubmissionMessage: 'خطایی در ارسال داده‌ها رخ داد. لطفاً مجدداً تلاش کنید.',
        };
        
        // DEVELOPER NOTE: Change this endpoint to your desired submission URL.
        const SUBMISSION_ENDPOINT = 'https://n8n.rymon-afzar.ir/webhook/api/hr/form/employee';
        const HR_DEPARTMENT_ID = 'hr';
        const MAX_FILE_SIZE_MB = 8;
        const SKILL_MIN = 3;
        const SKILL_MAX = 5;

        const form = document.getElementById('training-needs-form');
        const modal = document.getElementById('confirmation-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalMessage = document.getElementById('modal-message');
        const departmentSelect = document.getElementById('department');
        const mainFormFields = document.getElementById('main-form-fields');
        const comingSoonState = document.getElementById('coming-soon-state');

        if (typeof populateDepartmentSelect === 'function') {
            populateDepartmentSelect(document.getElementById('department'));
        }

        /**
         * Toggles form visibility based on department selection
         */
        function handleDepartmentChange() {
            const hasSelection = departmentSelect.value;
            const selectedDepartmentId = typeof getSelectedDepartmentId === 'function'
                ? getSelectedDepartmentId(departmentSelect)
                : '';
            const isHR = selectedDepartmentId === HR_DEPARTMENT_ID;
            const submitBtn = document.getElementById('submit-btn');
            
            if (isHR) {
                mainFormFields.style.display = 'block';
                comingSoonState.style.display = 'none';
                if (submitBtn) {
                    submitBtn.disabled = false;
                    submitBtn.style.opacity = '1';
                    submitBtn.style.cursor = 'pointer';
                }
            } else if (hasSelection) {
                mainFormFields.style.display = 'none';
                comingSoonState.style.display = 'block';
                if (submitBtn) {
                    submitBtn.disabled = true;
                    submitBtn.style.opacity = '0.5';
                    submitBtn.style.cursor = 'not-allowed';
                }
            } else {
                mainFormFields.style.display = 'none';
                comingSoonState.style.display = 'none';
                if (submitBtn) {
                    submitBtn.disabled = true;
                    submitBtn.style.opacity = '0.5';
                    submitBtn.style.cursor = 'not-allowed';
                }
            }
        }

        // Initialize form state - hide fields until department is selected
        if (departmentSelect && mainFormFields && comingSoonState) {
            departmentSelect.addEventListener('change', () => {
                departmentSelect.dataset.selectedId = typeof getSelectedDepartmentId === 'function'
                    ? getSelectedDepartmentId(departmentSelect)
                    : '';
                handleDepartmentChange();
            });
            mainFormFields.style.display = 'none';
            const submitBtn = document.getElementById('submit-btn');
            if (submitBtn) {
                submitBtn.disabled = true;
                submitBtn.style.opacity = '0.5';
                submitBtn.style.cursor = 'not-allowed';
            }
        }

        // Other Skills Functionality
        const skillOtherCheckbox = document.getElementById('skill-other-checkbox');
        const otherSkillsContainer = document.getElementById('other-skills-container');
        const otherSkillsInputs = document.getElementById('other-skills-inputs');
        const addAnotherSkillBtn = document.getElementById('add-another-skill-btn');

        /**
         * Toggles visibility of other skills input container
         */
        function toggleOtherSkillsContainer() {
            if (skillOtherCheckbox && otherSkillsContainer) {
                if (skillOtherCheckbox.checked) {
                    otherSkillsContainer.style.display = 'block';
                    // Focus on first input
                    const firstInput = otherSkillsContainer.querySelector('.skill-other-input');
                    if (firstInput) {
                        setTimeout(() => firstInput.focus(), 100);
                    }
                } else {
                    otherSkillsContainer.style.display = 'none';
                    // Clear all inputs when hidden
                    document.querySelectorAll('.skill-other-input').forEach(input => {
                        input.value = '';
                    });
                    // Reset to single input
                    resetOtherSkillsInputs();
                }
            }
        }

        /**
         * Adds a new skill input field
         */
        function addSkillInput() {
            if (!otherSkillsInputs) return;

            const skillCount = otherSkillsInputs.querySelectorAll('.other-skill-item').length;
            
            // Limit to 5 total skills (3-5 requirement, so max 2 additional "other" skills)
            const regularSkills = form.querySelectorAll('input[name="required-skills"]:checked:not(#skill-other-checkbox)').length;
            const otherInputsFilled = Array.from(document.querySelectorAll('.skill-other-input'))
                .filter(input => input.value.trim() !== '').length;
            
            if (regularSkills + otherInputsFilled >= SKILL_MAX) {
                showModal('توجه', `شما مجاز به انتخاب حداکثر ${SKILL_MAX} مهارت هستید.`);
                return;
            }

            const newItem = document.createElement('div');
            newItem.className = 'other-skill-item';
            newItem.innerHTML = `
                <input type="text" class="skill-other-input" name="required-skills-other" placeholder="مهارت دیگر را وارد کنید" maxlength="100">
                <button type="button" class="remove-skill-btn" aria-label="حذف">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            `;
            
            otherSkillsInputs.appendChild(newItem);
            
            // Add remove button event
            const removeBtn = newItem.querySelector('.remove-skill-btn');
            removeBtn.addEventListener('click', () => removeSkillInput(newItem));
            
            // Focus on new input
            const newInput = newItem.querySelector('.skill-other-input');
            if (newInput) {
                setTimeout(() => newInput.focus(), 100);
            }

            // Update remove button visibility
            updateRemoveButtonVisibility();
        }

        /**
         * Removes a skill input field
         */
        function removeSkillInput(item) {
            if (!otherSkillsInputs) return;
            
            const itemCount = otherSkillsInputs.querySelectorAll('.other-skill-item').length;
            if (itemCount > 1) {
                item.remove();
                updateRemoveButtonVisibility();
            }
        }

        /**
         * Resets to single input
         */
        function resetOtherSkillsInputs() {
            if (!otherSkillsInputs) return;
            
            const items = otherSkillsInputs.querySelectorAll('.other-skill-item');
            items.forEach((item, index) => {
                if (index === 0) {
                    item.querySelector('.skill-other-input').value = '';
                } else {
                    item.remove();
                }
            });
            updateRemoveButtonVisibility();
        }

        /**
         * Updates remove button visibility (hide for first item)
         */
        function updateRemoveButtonVisibility() {
            if (!otherSkillsInputs) return;
            const items = otherSkillsInputs.querySelectorAll('.other-skill-item');
            items.forEach((item, index) => {
                const removeBtn = item.querySelector('.remove-skill-btn');
                if (removeBtn) {
                    removeBtn.style.display = index === 0 ? 'none' : 'flex';
                }
            });
        }

        // Event listeners for other skills
        if (skillOtherCheckbox) {
            skillOtherCheckbox.addEventListener('change', toggleOtherSkillsContainer);
        }

        if (addAnotherSkillBtn) {
            addAnotherSkillBtn.addEventListener('click', addSkillInput);
        }

        // Course Links Functionality
        const courseLinksInputs = document.getElementById('course-links-inputs');
        const addAnotherLinkBtn = document.getElementById('add-another-link-btn');

        /**
         * Adds a new course link input field
         */
        function addCourseLinkInput() {
            if (!courseLinksInputs) return;

            const newItem = document.createElement('div');
            newItem.className = 'course-link-item';
            newItem.innerHTML = `
                <div class="course-link-input-wrapper">
                    <svg class="link-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                        <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                    </svg>
                    <input type="url" class="course-link-input" name="course-links" placeholder="https://example.com/course" pattern="https?://.+" maxlength="500">
                </div>
                <button type="button" class="remove-link-btn" aria-label="حذف لینک">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            `;
            
            courseLinksInputs.appendChild(newItem);
            
            // Add remove button event
            const removeBtn = newItem.querySelector('.remove-link-btn');
            removeBtn.addEventListener('click', () => removeCourseLinkInput(newItem));
            
            // Focus on new input
            const newInput = newItem.querySelector('.course-link-input');
            if (newInput) {
                setTimeout(() => newInput.focus(), 100);
            }

            // Update remove button visibility
            updateRemoveLinkButtonVisibility();
        }

        /**
         * Removes a course link input field
         */
        function removeCourseLinkInput(item) {
            if (!courseLinksInputs) return;
            
            const itemCount = courseLinksInputs.querySelectorAll('.course-link-item').length;
            if (itemCount > 1) {
                item.remove();
                updateRemoveLinkButtonVisibility();
            }
        }

        /**
         * Updates remove button visibility (hide for first item)
         */
        function updateRemoveLinkButtonVisibility() {
            if (!courseLinksInputs) return;
            const items = courseLinksInputs.querySelectorAll('.course-link-item');
            items.forEach((item, index) => {
                const removeBtn = item.querySelector('.remove-link-btn');
                if (removeBtn) {
                    removeBtn.style.display = index === 0 ? 'none' : 'flex';
                }
            });
        }

        // Event listeners for course links
        if (addAnotherLinkBtn) {
            addAnotherLinkBtn.addEventListener('click', addCourseLinkInput);
        }

        // Initialize: setup remove buttons for existing items
        if (courseLinksInputs) {
            const existingItems = courseLinksInputs.querySelectorAll('.course-link-item');
            existingItems.forEach((item, index) => {
                const removeBtn = item.querySelector('.remove-link-btn');
                if (removeBtn) {
                    removeBtn.addEventListener('click', () => removeCourseLinkInput(item));
                    removeBtn.style.display = index === 0 ? 'none' : 'flex';
                }
            });
        }

        // Priority Selection Functionality
        const priorityCards = document.querySelectorAll('.priority-card');
        const priorityTypeMap = {
            'online': 'آنلاین (زنده)',
            'inperson': 'حضوری',
            'blended': 'ترکیبی',
            'offline': 'آفلاین (ضبط شده)'
        };

        /**
         * Handles priority button click
         */
        function handlePriorityClick(card, priority) {
            const hiddenInput = card.querySelector('input[type="hidden"]');
            const indicator = card.querySelector('.priority-selected-indicator');
            const buttons = card.querySelectorAll('.priority-btn');
            const cardType = card.getAttribute('data-type');
            
            // Remove selected state from all buttons in this card
            buttons.forEach(btn => btn.classList.remove('selected'));
            
            // Find and select the clicked button
            const clickedBtn = card.querySelector(`.priority-btn[data-priority="${priority}"]`);
            if (clickedBtn) {
                clickedBtn.classList.add('selected');
                
                // Update hidden input
                if (hiddenInput) {
                    hiddenInput.value = priority;
                }
                
                // Update card state
                card.classList.add('has-priority');
                
                // Update indicator text
                if (indicator) {
                    indicator.textContent = `اولویت انتخاب شده: ${priority}`;
                }
                
                // Check for conflicts with other cards
                checkPriorityConflicts();
            }
        }

        /**
         * Checks for priority conflicts and updates button states
         */
        function checkPriorityConflicts() {
            const allPriorityValues = {};
            const conflicts = new Set();
            
            // Collect all selected priorities
            priorityCards.forEach(card => {
                const hiddenInput = card.querySelector('input[type="hidden"]');
                if (hiddenInput && hiddenInput.value) {
                    const priority = hiddenInput.value;
                    if (allPriorityValues[priority]) {
                        conflicts.add(priority);
                    }
                    allPriorityValues[priority] = card;
                }
            });
            
            // Highlight conflicts if any
            priorityCards.forEach(card => {
                const hiddenInput = card.querySelector('input[type="hidden"]');
                if (hiddenInput && hiddenInput.value && conflicts.has(hiddenInput.value)) {
                    card.style.borderColor = 'var(--danger-color)';
                    const indicator = card.querySelector('.priority-selected-indicator');
                    if (indicator) {
                        indicator.textContent += ' (تکرار!)';
                        indicator.style.color = 'var(--danger-color)';
                    }
                } else {
                    const indicator = card.querySelector('.priority-selected-indicator');
                    if (indicator && indicator.textContent.includes('(تکرار!)')) {
                        indicator.style.color = 'var(--primary-color)';
                        indicator.textContent = indicator.textContent.replace(' (تکرار!)', '');
                    }
                    if (hiddenInput && hiddenInput.value) {
                        card.style.borderColor = 'var(--primary-color)';
                    }
                }
            });
        }

        // Initialize priority buttons
        priorityCards.forEach(card => {
            const buttons = card.querySelectorAll('.priority-btn');
            buttons.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    const priority = btn.getAttribute('data-priority');
                    handlePriorityClick(card, priority);
                });
            });
        });

        /**
         * Clears all existing error messages.
         */
        function clearAllErrors() {
            document.querySelectorAll('.is-invalid').forEach(el => el.classList.remove('is-invalid'));
            document.querySelectorAll('.error-message').forEach(el => el.style.display = 'none');
        }

        /**
         * Shows an error message for a specific element.
         * @param {string} id The ID of the form-group or specific error-message container.
         * @param {string} message The error message to display.
         */
        function showError(id, message) {
            const container = document.getElementById(id);
            if (container) {
                container.classList.add('is-invalid');
                const errorEl = container.querySelector('.error-message') || document.getElementById('error-' + id.replace('group-', ''));
                if (errorEl) {
                    errorEl.textContent = message;
                    errorEl.style.display = 'block';
                }
            } else {
                console.warn('Error container not found:', id);
            }
        }

        /**
         * Client-side validation function.
         * @returns {boolean} True if the form is valid, false otherwise.
         */
        function validateForm() {
            clearAllErrors();
            let isValid = true;

            // 1. Department selection
            if (!departmentSelect.value) {
                showError('group-department', STRINGS.errorRequired);
                isValid = false;
            }

            // If not HR department, don't validate other fields
            const selectedDepartmentId = typeof getSelectedDepartmentId === 'function'
                ? getSelectedDepartmentId(departmentSelect)
                : '';
            if (selectedDepartmentId !== HR_DEPARTMENT_ID) {
                return isValid; // Return early validation for non-HR departments
            }

            // 2, 3 & 4. Basic required text fields (only for HR)
            ['personnel-id', 'full-name', 'job-title'].forEach(id => {
                const input = document.getElementById(id);
                if (!input.value.trim()) {
                    showError('group-' + id, STRINGS.errorRequired);
                    isValid = false;
                }
            });

            // 4. Years of Service (Radio Group)
            if (!form.querySelector('input[name="years-of-service"]:checked')) {
                showError('error-years-of-service', STRINGS.errorRequired);
                isValid = false;
            }
            
            // 5. Main Activity Area (Checkbox Group)
            if (form.querySelectorAll('input[name="activity-area"]:checked').length === 0) {
                showError('error-activity-area', STRINGS.errorRequired);
                isValid = false;
            }

            // 6. Required Skills (Checkbox Group with min/max)
            // Count regular skills (excluding "other" checkbox)
            const regularSkillChecks = form.querySelectorAll('input[name="required-skills"]:checked:not(#skill-other-checkbox)');
            const regularSkillCount = regularSkillChecks.length;
            
            // Count filled other skill inputs
            const otherSkillInputs = Array.from(document.querySelectorAll('.skill-other-input'))
                .filter(input => input.value.trim() !== '');
            const otherSkillCount = otherSkillInputs.length;
            
            // Total skill count
            const totalSkillCount = regularSkillCount + otherSkillCount;
            
            // Validate that if "other" is checked, at least one other input is filled
            const isOtherChecked = skillOtherCheckbox && skillOtherCheckbox.checked;
            if (isOtherChecked && otherSkillCount === 0) {
                showError('error-required-skills', 'لطفاً حداقل یک مهارت دیگر را وارد کنید.');
                isValid = false;
            }
            
            if (totalSkillCount < SKILL_MIN) {
                showError('error-required-skills', STRINGS.errorMinSkills.replace('{min}', SKILL_MIN));
                isValid = false;
            } else if (totalSkillCount > SKILL_MAX) {
                showError('error-required-skills', STRINGS.errorMaxSkills.replace('{max}', SKILL_MAX));
                isValid = false;
            }

            // 7. Training Priority (Visual Selection)
            const priorityInputs = Array.from(document.querySelectorAll('#training-priorities input[type="hidden"]'));
            const priorities = priorityInputs.map(input => parseInt(input.value)).filter(val => !isNaN(val) && val >= 1 && val <= 4);
            
            // Check for correct number of values and no duplicates
            if (priorities.length !== 4 || new Set(priorities).size !== 4) {
                showError('error-priorities', STRINGS.errorPriorityConflict);
                isValid = false;
            }
            
            return isValid;
        }

        /**
         * Collects form data into a structured JSON object.
         * @returns {object} The structured form data.
         */
        function serializeForm() {
            const data = {};
            const formData = new FormData(form);

            // 1. Department
            const departmentName = formData.get('department') || '';
            const departmentId = typeof getSelectedDepartmentId === 'function'
                ? getSelectedDepartmentId(departmentSelect)
                : '';
            data['department'] = departmentName;
            data['departmentId'] = departmentId;
            data['departmentName'] = departmentName;

            // 2, 3 & 4. Text fields
            data['personnel-id'] = formData.get('personnel-id');
            data['full-name'] = formData.get('full-name');
            data['job-title'] = formData.get('job-title');
            
            // 4. Radio Group
            data['years-of-service'] = formData.get('years-of-service');

            // 5. Checkbox Group (Activity Area)
            data['activity-area'] = formData.getAll('activity-area');

            // 6. Checkbox Group (Required Skills)
            // Get regular skills (excluding "other" checkbox)
            const allSkills = formData.getAll('required-skills');
            const skills = allSkills.filter(skill => skill !== 'other');
            
            // Get all other skill inputs
            const otherSkills = formData.getAll('required-skills-other').filter(skill => skill.trim() !== '');
            otherSkills.forEach(otherSkill => {
                skills.push('سایر (' + otherSkill + ')');
            });
            
            data['required-skills'] = skills;
            
            // 7. Priority Ranking
            data['training-priority'] = {};
            document.querySelectorAll('#training-priorities .priority-card').forEach(card => {
                const hiddenInput = card.querySelector('input[type="hidden"]');
                const title = card.querySelector('.priority-card-title');
                if (hiddenInput && title && hiddenInput.value) {
                    data['training-priority'][title.textContent.trim()] = parseInt(hiddenInput.value);
                }
            });

            // 8. Course Links (Optional)
            const courseLinks = formData.getAll('course-links').filter(link => link.trim() !== '');
            data['course-links'] = courseLinks;

            // 9. Optional Comment
            data['additional-comments'] = formData.get('additional-comments');

            return data;
        }

        /**
         * Displays the confirmation/error modal.
         * @param {string} title The title for the modal.
         * @param {string} message The message body.
         */
        function showModal(title, message) {
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            modal.style.display = 'block';
        }

        // --- SIMPLE API CALL ---
        
        const submitBtn = document.getElementById('submit-btn');
        const API_URL = 'https://n8n.rymon-afzar.ir/webhook/api/hr/form/employee';
        
        // Show loading
        function showLoading() {
            if (submitBtn) {
                submitBtn.disabled = true;
                submitBtn.innerHTML = '⏳ در حال ارسال...';
            }
        }
        
        // Hide loading
        function hideLoading() {
            if (submitBtn) {
                submitBtn.disabled = false;
                submitBtn.innerHTML = 'ارسال <svg style="margin-right: 8px; vertical-align: middle;" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>';
            }
        }
        
        // SIMPLE BUTTON CLICK - DIRECT API CALL
        if (submitBtn) {
            submitBtn.onclick = function(e) {
                e.preventDefault();
                
                // Show loading FIRST
                showLoading();
                
                // Get form data
                const payload = serializeForm();
                console.log('Sending:', payload);
                
                // CALL API - SIMPLE AND DIRECT
                fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                })
                .then(res => res.text())
                .then(text => {
                    hideLoading();
                    console.log('Response:', text);
                    showModal('✅ موفق', 'داده‌ها با موفقیت ارسال شد');
                })
                .catch(err => {
                    hideLoading();
                    console.error('Error:', err);
                    showModal('❌ خطا', 'خطا در ارسال: ' + err.message);
                });
            };
        }
        
        // Also handle form submit
        if (form) {
            form.onsubmit = function(e) {
                e.preventDefault();
                if (submitBtn) submitBtn.click();
            };
        }
        
        // Modal close functionality
        document.querySelector('.close-btn').onclick = () => {
            modal.style.display = 'none';
        };
        window.onclick = (event) => {
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        };

    </script>

</body>
</html>